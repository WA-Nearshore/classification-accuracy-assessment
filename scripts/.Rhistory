c
# Compute fuzzy error matrix
# Set env
library(sf)
# Load data
sample_points <- st_read(dsn = "../KAMaccuracy.gdb",
layer = "TAC_2022_SamplePoints_Method2_Fuzzy")
c
# Compute matrix
m <- table(Prediction = sample_points$Classified,
Reference = sample_points$GrndTruth)
print(m)
# Values in col "2" are acceptably kelp or water
# Compute accuracy stats
# Overall accuracy = correctly classed points / total points
overall_accuracy <- sum(diag(m)) / sum(m))
# Overall accuracy = correctly classed points / total points
overall_accuracy <- sum(diag(m)) / sum(m)
# Producers
fuzzy_prod_kelp <- (m[2,2] + m[1,3])/ (m[2,2] + m[1,3] + m[1,2])
det_prod_kelp <- (m[2,2])/ (m[2,2] + m[1,3] + m[1,2])
fuzzy_prod_water <- (m[1,1] + m[2,3]) / (m[1,1] + m[2,3] + m[2,1])
det_prod_water <- (m[1,1]) / (m[1,1] + m[2,3] + m[2,1])
# Users
fuzzy_u_kelp <- (m[2,2] + m[2,3])/ (m[2,1] + m[2,2] + m[2,3])
det_u_kelp <- (m[2,2])/ (m[2,1] + m[2,2] + m[2,3])
fuzzy_u_water <- (m[1,1] + m[1,3]) / (m[1,1] + m[1,2] + m[1,3])
det_u_water <- (m[1,1] + m[1,3]) / (m[1,1] + m[1,2] + m[1,3])
# Compute deterministic kappa
# prepare "deterministic' matrix where all fuzzy acceptables are treated as incorrect
m_det <- m[, -3]
m_det[1,2] <- m[1,2] + m[1,3]
m_det[2,1] <- m[2,1] + m[2,3]
print(m_det)
Po <- sum(diag(m_det))/sum(m_det)
Pe <- sum(rowSums(m_det) * colSums(m_det)) / (sum(m_det))^2
kappa_det <- (Po - Pe) / (1 - Pe)
# Compute fuzzy kappa
# prepare "fuzzy" matrix where all fuzzy acceptables are treated as correct
m_fuzz <- m[, -3]
m_fuzz[1,1] <- m[1,1] + m[1,3]
m_fuzz[2,2] <- m[2,2] + m[2,3]
print(m_fuzz)
Po <- sum(diag(m_fuzz))/sum(m_fuzz)
Pe <- sum(rowSums(m_fuzz) * colSums(m_fuzz)) / (sum(m_fuzz))^2
kappa_fuzz <- (Po - Pe) / (1 - Pe)
install.packages("glue")
library(sf)
library(glue)
# initialize dataframe
results <- data.frame(
aoi = character(),
u_water = numeric(),
u_kelp = numeric(),
p_water = numeric(),
p_kelp = numeric(),
overall_accuracy = numeric(),
kappa = numeric()
)
View(results)
aois <- list("ADM", "CHP", "CYP", "NCO", "NPS", "SJF", "SJI", "SMI", "TAC")
View(aois)
# open tables
for (aoi in aois){
error_mat <- st_read(dsn = "../KAMaccuracy.gdb",
layer = glue("{aoi}_2022_ConfMatrix"))
print(head(error_mat))
}
View(error_mat)
# open tables
for (aoi in aois){
confmat <- st_read(dsn = "../KAMaccuracy.gdb",
layer = glue("{aoi}_2022_ConfMatrix"))
# extract values of interest
aoi_row <- data.frame(
aoi = aoi,
u_water = confmat[1,5],
u_kelp = confmat[2,5],
p_water = confmat[4,2],
p_kelp = confmat[4,3],
overall_accuracy = confmat[4,5],
kappa = confmat[6,5]
)
print(aoi_row)
}
# open tables
for (aoi in aois){
confmat <- st_read(dsn = "../KAMaccuracy.gdb",
layer = glue("{aoi}_2022_ConfMatrix"))
# extract values of interest
aoi_row <- data.frame(
aoi = aoi,
u_water = confmat[1,5],
u_kelp = confmat[2,5],
p_water = confmat[4,2],
p_kelp = confmat[4,3],
overall_accuracy = confmat[4,5],
kappa = confmat[5,6]
)
print(aoi_row)
}
# open tables
for (aoi in aois){
confmat <- st_read(dsn = "../KAMaccuracy.gdb",
layer = glue("{aoi}_2022_ConfMatrix"))
# extract values of interest
aoi_row <- data.frame(
aoi = aoi,
u_water = confmat[1,5],
u_kelp = confmat[2,5],
p_water = confmat[4,2],
p_kelp = confmat[4,3],
overall_accuracy = confmat[4,5],
kappa = confmat[5,6]
)
# append to dataframe
rbind(results, aoi_row)
}
View(results)
library(dplyr)
# open tables
for (aoi in aois){
confmat <- st_read(dsn = "../KAMaccuracy.gdb",
layer = glue("{aoi}_2022_ConfMatrix"))
# extract values of interest
aoi_row <- data.frame(
aoi = aoi,
u_water = confmat[1,5],
u_kelp = confmat[2,5],
p_water = confmat[4,2],
p_kelp = confmat[4,3],
overall_accuracy = confmat[4,5],
kappa = confmat[5,6]
)
# append to dataframe
results <- bind_rows(results, aoi_row)
}
View(results)
kelp_acc_plot <- ggplot(results, aes(x=aoi, y=u_kelp)) +
geom_bar()
library(ggplot)
kelp_acc_plot()
kelp_acc_plot <- ggplot(results, aes(x=aoi, y=u_kelp)) +
geom_bar()
library(ggplot)
library(tidyverse)
kelp_acc_plot <- ggplot(results, aes(x=aoi, y=u_kelp)) +
geom_bar()
kelp_acc_plot
kelp_acc_plot <- ggplot(results, aes(x=aoi, y=u_kelp)) +
geom_col()
kelp_acc_plot
kelp_acc_plot <- ggplot() +
geom_col(results, aes(x=aoi, y=u_kelp, fill="blue")) +
geom_col(results, aes(x=aoi, y=p_kelp, fill'darkblue'))
kelp_acc_plot <- ggplot() +
geom_col(results, aes(x=aoi, y=u_kelp, fill="blue")) +
geom_col(results, aes(x=aoi, y=p_kelp, fill='darkblue'))
kelp_acc_plot <- ggplot(results, aes(x=aoi, y=u_kelp, fill="blue")) +
geom_col()
kelp_acc_plot
kelp_acc_plot <- ggplot(results, aes(x=aoi, y=u_kelp)) +
geom_col()
kelp_acc_plot
library(ggthemes)
results_long <- results %>% pivot_longer(
cols = c("u_water", "u_kelp", "p_water", "p_kelp", "overall_accuracy", "kappa"),
names_to = "stat_type",
values_to = "stat_value"
)
View(results_long)
kelp_acc_plot <- ggplot(results, aes(x=aoi, y=stat_type)) +
geom_col() +
facet_wrap(~stat_type)
kelp_acc_plot
kelp_acc_plot <- ggplot(results, aes(x=aoi, y=stat_value)) +
geom_col() +
facet_wrap(~stat_type)
kelp_acc_plot
kelp_acc_plot <- ggplot(results, aes(x=aoi, y=stat_value)) +
geom_col() +
facet_wrap(~stat_type)
kelp_acc_plot
kelp_acc_plot <- ggplot(results_long, aes(x=aoi, y=stat_value)) +
geom_col() +
facet_wrap(~ stat_type)
kelp_acc_plot
kelp_acc_plot <- ggplot(results_long, aes(x=aoi, y=stat_value)) +
geom_col() +
facet_wrap(~ stat_type, ncol = 1)
kelp_acc_plot
results_long_filt <- results_long %>% filter(stat_type != "p_water" | stat_type != "u_water")
kelp_acc_plot <- ggplot(results_long_filt, aes(x=aoi, y=stat_value)) +
geom_col() +
facet_wrap(~ stat_type, ncol = 1)
kelp_acc_plot
results_long_filt <- results_long %>% filter(stat_type != "p_water" & stat_type != "u_water")
kelp_acc_plot <- ggplot(results_long_filt, aes(x=aoi, y=stat_value)) +
geom_col() +
facet_wrap(~ stat_type, ncol = 1)
kelp_acc_plot
kelp_acc_plot <- ggplot(results_long_filt, aes(x=aoi, y=stat_value)) +
geom_col() +
facet_wrap(~ stat_type, ncol = 1) +
ylab = ""
kelp_acc_plot <- ggplot(results_long_filt, aes(x=aoi, y=stat_value)) +
geom_col() +
facet_wrap(~ stat_type, ncol = 1) +
theme_solarized()
kelp_acc_plot
kelp_acc_plot <- ggplot(results_long_filt, aes(x=aoi, y=stat_value)) +
geom_col() +
facet_wrap(~ stat_type, ncol = 1) +
theme_classic()
kelp_acc_plot
kelp_acc_plot <- ggplot(results_long_filt, aes(x=aoi, y=stat_value)) +
geom_col(width = 0.5) +
facet_wrap(~ stat_type, ncol = 1) +
theme_classic()
kelp_acc_plot
acc_plot2 <- ggplot(results_long_filt, aes(x=aoi, y=stat_value, fill=stat_type)) +
geom_col()
acc_plot2
acc_plot
acc_plot2 <- ggplot(results_long_filt, aes(x=aoi, y=stat_value, fill=stat_type)) +
geom_col(position = "dodge")
acc_plot2
acc_plot2 <- ggplot(results_long_filt, aes(x=aoi, y=stat_value, fill=stat_type)) +
geom_col(position = "dodge") +
theme_classic()
acc_plot2
acc_plot <- ggplot(results_long_filt, aes(x=aoi, y=stat_value)) +
geom_col() +
facet_wrap(~ stat_type, ncol = 1) +
theme_classic()
acc_plot
acc_plot <- ggplot(results_long_filt, aes(x=aoi, y=stat_value)) +
geom_point() +
facet_wrap(~ stat_type, ncol = 1) +
theme_classic()
acc_plot
